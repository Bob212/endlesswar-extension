(()=>{"use strict";const e=()=>{let e=l();e&&(console.log("Hospital Cure"),frames[1].document.location.href=`https://avalon.endlesswar.ru/hospital.php?cmd=hospital.show&set=recovery&nd=${e}&${Math.random()}`)},t=()=>{let e=l();return!!e&&(console.log("Creating haot fight"),frames[1].document.location.href=`https://avalon.endlesswar.ru/zayavka.php?nd=${e}&cmd=haot.create&gradesmembers=3&startime2=3&timeout=3&blood=1&cmt=&open=1`,!0)},a=[{cookieName:"ext-carnage-spin-wheel",func:async()=>{let e=l();if(!e)return;console.log("Крутим колесо");let t=Math.random(),a=await fetch(`https://avalon.endlesswar.ru/wheel.php?cmd=wheel.turn&nd=${e}&${t}`,{method:"GET",referrer:"https://avalon.endlesswar.ru/lotery.php"}),o="";a.ok?o=await a.text():alert("Ошибка HTTP: "+a.status);let n=document.createElement("p");n.innerHTML=o,console.log("Result: ",n.children[0].children[0].getAttribute("text"))}},{cookieName:"ext-carnage-shadow-fight",func:()=>{console.log("Fighting with Shadow!"),frames[1].document.location.href="https://avalon.endlesswar.ru/zayavka.php?level=duel&duel_shadow=1"}},{cookieName:"ext-carnage-haot-fight-create",func:t},{cookieName:"ext-carnage-hospital-cure",func:e},{cookieName:"ext-carnage-clear-chat",func:()=>{frames[2].frames[1].document.querySelector("#chat-channels").children[1].innerHTML="",localStorage.avalonMessages=""}}],o=e=>{let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},n=e=>{((e,t,a={})=>{(a={path:"/",...a}).expires instanceof Date&&(a.expires=a.expires.toUTCString());let o=encodeURIComponent(e)+"="+encodeURIComponent(t);for(let e in a){o+="; "+e;let t=a[e];!0!==t&&(o+="="+t)}document.cookie=o})(e,"",{"max-age":-1})};a.forEach((e=>{n(e.cookieName)}));const r=(s=document.cookie,function(){var e=document.cookie;e!=s&&(s=e,a.forEach((e=>{"true"==o(e.cookieName)&&(e.func(),n(e.cookieName))})))});var s;const l=()=>{if(sessionStorage.identifND)return+sessionStorage.identifND;if(!frames[1].document.querySelector('input[name="nd"]'))return frames[1].document.location.href="https://avalon.endlesswar.ru/inventory.php?"+Math.random(),console.log("Нужно зайти в инвентарь!"),!1;let e=frames[1].document.querySelector('input[name="nd"]').value;return sessionStorage.identifND=""+e,e},i=()=>+frames[0].document.querySelector("#dvhp").innerText,c=()=>+frames[0].document.querySelector("#dvmaxhp").innerText,u=()=>+frames[0].document.querySelector("#dvmana").innerText,m=()=>+frames[0].document.querySelector("#dvmaxmana").innerText;let h=!1,d=!1,f=!1,g=!1,p=!1,x=!1,S=!1;const v={max:0},w={current:0,max:0},T=["https://img.endlesswar.ru/i/rune/8.gif","https://img.endlesswar.ru/i/rune/78.gif"],y=e=>!![...frames[1].document.querySelectorAll('li[data-slot-name="rune"]')].find((t=>{const a=t.querySelector("img");if(a&&a.src===e){let e=(""+a.getAttribute("onclick")).match(/window.location=(.*);}/)[1].trim();return e=e.slice(1,-1),frames[1].document.location.href="https://avalon.endlesswar.ru/"+e,!0}}));console.log("Endlesswar extension is now working");let k=!1;setInterval((()=>{(e=>{if("true"==o("ext-carnage-autofight")&&frames[1]&&frames[1].document)if(frames[1].document.location.href.includes("https://avalon.endlesswar.ru/fbattle.php")){if(f||g)return void console.log("Waiting...");if(d){d=!1,localStorage.inThisFightCurrentManaUses=0,localStorage.inThisFightCurrentHealUses=0,p=+o("ext-carnage-autofight-animals"),p&&p>0&&(e=>{f=!0;for(let t=0;t<e;t++)setTimeout((()=>{console.log("Call dragon num: ",t+1),frames[1].location.href="https://avalon.endlesswar.ru/fbattle.php?cmd=ability.summon_pet"}),3e3*(t+1));setTimeout((()=>{f=!1}),3e3*(e+1))})(p);const e=+o("ext-carnage-autofight-delay");return void(e&&e>0&&(g=!0,setTimeout((()=>{g=!1}),1e3*e)))}if(x=+o("ext-carnage-autofight-mana"),x&&x>0&&(v.max=x,!(+localStorage.inThisFightCurrentManaUses>=v.max)&&u()+100<maxMana()&&(console.log("using mana"),y("https://img.endlesswar.ru/i/rune/37.gif"),localStorage.inThisFightCurrentManaUses=+localStorage.inThisFightCurrentManaUses+1,f=!0,setTimeout((()=>{f=!1}),3e3),1)))return;if(S=o("ext-carnage-autofight-autoheal"),"true"==S&&(()=>{if(w.max=+o("ext-carnage-autoheal-num"),w.current=+localStorage.inThisFightCurrentHealUses,w.current>=w.max)return!1;const e=+o("ext-carnage-autoheal-minhp");if(i()>e)return!1;let t=!1;return T.find((e=>!!y(e)&&(t=!0,!0))),!!t&&(localStorage.inThisFightCurrentHealUses=+localStorage.inThisFightCurrentHealUses+1,f=!0,setTimeout((()=>{f=!1}),3e3),!0)})())return;if(console.log("Hit an oppenent"),frames[1].document.forms.bform)return void frames[1].document.forms.bform.submit();if(frames[1].document.querySelector("#buttonRefresh"))return void frames[1].document.querySelector("#buttonRefresh").click();frames[1].document.querySelector(".xbbutton")&&(frames[1].document.querySelector(".xbbutton").click(),d=!0,localStorage.inThisFightCurrentManaUses=0,localStorage.inThisFightCurrentHealUses=0)}else d=!0})(),h||"true"==o("ext-carnage-auto-create-haot-fight")&&frames[1]&&frames[1].document&&(frames[1].document.location.href.includes("https://avalon.endlesswar.ru/fbattle.php")||c()!=+o("ext-carnage-mymaxhp")||(i()+150<=c()||u()+150<=m()?(i()<=c()/1.6||u()<=m()/1.6)&&"true"===o("ext-carnage-auto-regeneration-in-hospital")?(console.log("Need to USE hospital"),e(),h=!0,setTimeout((()=>{h=!1}),5e3)):console.log("Regeneration..."):t()&&(console.log("Создаем заявку на бой"),h=!0,setTimeout((()=>{h=!1}),18e4))))}),1500),setTimeout((()=>{k=!0}),6e5),setTimeout((()=>{if(localStorage.avalonMessages&&frames[2]&&localStorage.avalonMessages){const e=frames[2].frames[1].document.querySelector("#chat-channels").children[1];e.innerHTML=`${localStorage.avalonMessages}${e.innerHTML}`}}),5e3),window.setInterval(r,100)})();