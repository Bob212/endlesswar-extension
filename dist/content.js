(()=>{"use strict";const e=e=>{let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},t=e=>{((e,t,o={})=>{(o={path:"/",...o}).expires instanceof Date&&(o.expires=o.expires.toUTCString());let n=encodeURIComponent(e)+"="+encodeURIComponent(t);for(let e in o){n+="; "+e;let t=o[e];!0!==t&&(n+="="+t)}document.cookie=n})(e,"",{"max-age":-1})},o=()=>{if(sessionStorage.identifND)return+sessionStorage.identifND;if(!frames[1].document.querySelector('input[name="nd"]'))return frames[1].document.location.href="https://avalon.endlesswar.ru/inventory.php?"+Math.random(),console.log("Нужно зайти в инвентарь!"),!1;let e=frames[1].document.querySelector('input[name="nd"]').value;return sessionStorage.identifND=""+e,e},n=()=>+frames[0].document.querySelector("#dvmaxhp").innerText,a=()=>+frames[0].document.querySelector("#dvmana").innerText,r=()=>+frames[0].document.querySelector("#dvmaxmana").innerText,c=()=>{if("false"===e("ext-carnage-auto-reload-page"))return;needToReloadWindow=!1,localStorage.avalonMessages=frames[2].frames[1].document.querySelector("#chat-channels").children[1].innerHTML;const t=window.location.href;window.open(t,"_blank"),window.close()};console.log("CRNG content");let s=!1,l=!1;setInterval((()=>{g(),y()}),1500),setTimeout((()=>{l=!0}),6e5),setTimeout((()=>{if(localStorage.avalonMessages&&frames[2]&&localStorage.avalonMessages){const e=frames[2].frames[1].document.querySelector("#chat-channels").children[1];e.innerHTML=`${localStorage.avalonMessages}${e.innerHTML}`}}),5e3);let i=!1,u=!1,m=!1,d=!1,f=!1;const h={current:0,max:1},g=()=>{if("true"==e("ext-carnage-autofight")&&frames[1]&&frames[1].document)if(frames[1].document.location.href.includes("https://avalon.endlesswar.ru/fbattle.php")){if(u||m)return void console.log("Waiting...");if(i){i=!1,d=+e("ext-carnage-autofight-animals"),d&&d>0&&v(d);const t=+e("ext-carnage-autofight-delay");return void(t&&t>0&&(m=!0,setTimeout((()=>{m=!1}),1e3*t)))}if(f=+e("ext-carnage-autofight-mana"),f&&f>0&&(h.max=f,w()))return;if(console.log("Hit an oppenent"),frames[1].document.forms.bform)return void frames[1].document.forms.bform.submit();if(frames[1].document.querySelector("#buttonRefresh"))return l&&c(),void frames[1].document.querySelector("#buttonRefresh").click();p()}else i=!0,l&&c()},p=()=>{frames[1].document.querySelector(".xbbutton")&&(frames[1].document.querySelector(".xbbutton").click(),i=!0,h.current=0)},v=e=>{u=!0;for(let t=0;t<e;t++)setTimeout((()=>{console.log("Call dragon num: ",t+1),frames[1].location.href="https://avalon.endlesswar.ru/fbattle.php?cmd=ability.summon_pet"}),3e3*(t+1));setTimeout((()=>{u=!1}),3e3*(e+1))},w=()=>!(h.current>=h.max)&&(a()+100<r()&&(console.log("using mana"),x("https://img.endlesswar.ru/i/rune/37.gif"),h.current+=1,u=!0,setTimeout((()=>{u=!1}),3e3),!0)),x=e=>{runesNodes=[...frames[1].document.querySelectorAll('li[data-slot-name="rune"]')],runesNodes.find((t=>{const o=t.querySelector("img");if(o&&o.src===e){let e=(""+o.getAttribute("onclick")).match(/window.location=(.*);}/)[1].trim();return e=e.slice(1,-1),frames[1].document.location.href="https://avalon.endlesswar.ru/"+e,!0}}))},S=()=>!!o()&&(console.log("Creating haot fight"),frames[1].document.location.href="https://avalon.endlesswar.ru/map.php?cmd=hell",!0),y=()=>{s||"true"==e("ext-carnage-auto-create-haot-fight")&&frames[1]&&frames[1].document&&(frames[1].document.location.href.includes("https://avalon.endlesswar.ru/fbattle.php")||n()==+e("ext-carnage-mymaxhp")&&(+frames[0].document.querySelector("#dvhp").innerText<n()||a()<r()||+frames[0].document.querySelector("#dvmonster").getAttribute("data-dvmonster")<5?console.log("Regeneration..."):S()&&(console.log("Создаем заявку на бой"),s=!0,setTimeout((()=>{s=!1}),18e4))))},T=[{cookieName:"ext-carnage-spin-wheel",func:async()=>{let e=o();if(!e)return;console.log("Крутим колесо");let t=Math.random(),n=await fetch(`https://avalon.endlesswar.ru/wheel.php?cmd=wheel.turn&nd=${e}&${t}`,{method:"GET",referrer:"https://avalon.endlesswar.ru/lotery.php"}),a="";n.ok?a=await n.text():alert("Ошибка HTTP: "+n.status);let r=document.createElement("p");r.innerHTML=a,console.log("Result: ",r.children[0].children[0].getAttribute("text"))}},{cookieName:"ext-carnage-shadow-fight",func:()=>{console.log("Fighting with Shadow!"),frames[1].document.location.href="https://avalon.endlesswar.ru/zayavka.php?level=duel&duel_shadow=1"}},{cookieName:"ext-carnage-haot-fight-create",func:S},{cookieName:"ext-carnage-hospital-cure",func:()=>{let e=o();e&&(console.log("Hospital Cure"),frames[1].document.location.href=`https://avalon.endlesswar.ru/hospital.php?cmd=hospital.show&set=recovery&nd=${e}&${Math.random()}`)}},{cookieName:"ext-carnage-clear-chat",func:()=>{frames[2].frames[1].document.querySelector("#chat-channels").children[1].innerHTML="",localStorage.avalonMessages=""}}];T.forEach((e=>{t(e.cookieName)}));const k=(b=document.cookie,function(){var o=document.cookie;o!=b&&(b=o,T.forEach((o=>{"true"==e(o.cookieName)&&(o.func(),t(o.cookieName))})))});var b;window.setInterval(k,100)})();